<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Genius</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        :root { --primary: #007bff; --gold: #d4af37; --bg: #050a14; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: var(--bg); display: flex; justify-content: center; align-items: center; font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; }
        .glow { position: absolute; width: 300px; height: 300px; background: radial-gradient(circle, rgba(0, 123, 255, 0.15) 0%, transparent 70%); border-radius: 50%; filter: blur(50px); z-index: 1; }
        .content { text-align: center; z-index: 10; width: 100%; }
        .title { font-size: 3rem; font-weight: 900; color: white; letter-spacing: 4px; margin: 0; text-transform: uppercase; position: relative; opacity: 0; transition: opacity 2s ease-in; }
        .title.visible { opacity: 1; }
        .caption { color: var(--gold); font-size: 0.9rem; letter-spacing: 6px; margin-top: 10px; font-weight: 600; text-transform: uppercase; opacity: 0.8; }
        .status-dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin: 40px auto 10px; animation: pulse 1.5s infinite; }
        .loading-text { color: rgba(255,255,255,0.4); font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; margin-top: 15px; }
        @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(2.5); opacity: 0; } 100% { transform: scale(1); opacity: 0; } }
    </style>
</head>
<body>
    <div class="glow"></div>
    <div class="content">
        <h1 id="title" class="title">AVIATOR GENIUS</h1>
        <div class="caption">Predict. Play. Win.</div>
        <div class="status-dot"></div>
        <div id="status" class="loading-text">Initializing Systems...</div>
    </div>

    <script>
        let retryCount = 0;

        function startEngine() {
            const statusEl = document.getElementById('status');

            if (typeof SUPABASE_URL !== 'undefined' && typeof SUPABASE_KEY !== 'undefined') {
                statusEl.innerText = "Config Linked. Connecting...";
                fadeInTitle();
                runAuthCheck();
            } else if (retryCount < 20) {
                retryCount++;
                statusEl.innerText = "Syncing Config (" + retryCount + ")...";
                setTimeout(startEngine, 500);
            } else {
                statusEl.innerText = "CRITICAL ERROR: CONFIG MISSING";
                statusEl.style.color = "#ff4d4d";
            }
        }

        function fadeInTitle() {
            const titleEl = document.getElementById('title');
            setTimeout(() => {
                titleEl.classList.add('visible');
            }, 500); // fade-in after 0.5s
        }

        async function runAuthCheck() {
            const statusEl = document.getElementById('status');
            try {
                const _supa = supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
                    auth: { persistSession: true, storage: localStorage }
                });

                const projectID = SUPABASE_URL.split('//')[1].split('.')[0];
                const cachedToken = localStorage.getItem(`sb-${projectID}-auth-token`);

                // Wait 7 seconds before redirect (splash duration)
                setTimeout(async () => {
                    const { data: { session } } = await _supa.auth.getSession();

                    if (session || cachedToken) {
                        statusEl.innerText = "ACCESS GRANTED";
                        window.location.href = 'home.html';
                    } else {
                        statusEl.innerText = "USER UNAUTHORIZED";
                        window.location.href = 'login.html';
                    }
                }, 7000);

            } catch (err) {
                console.error("Auth System Error:", err);
                statusEl.innerText = "CONNECTION ERROR";
                setTimeout(() => { window.location.href = 'login.html'; }, 1000);
            }
        }

        window.onload = startEngine;
    </script>
</body>
</html>